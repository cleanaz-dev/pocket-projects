// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

enum UserType {
  PARENT
  CHILD
}

enum LinkType {
  VIDEO
  DOCS
  IMAGE
  WEB
  PDF
}

model Family {
  id        String    @id @default(auto()) @map("_id") @db.ObjectId
  name      String
  users     User[]
  projects  Project[]
  createdAt DateTime  @default(now())
}

model User {
  id        String    @id @default(auto()) @map("_id") @db.ObjectId
  email     String?   @unique
  name      String
  password  String?
  type      UserType
  familyId  String    @db.ObjectId
  family    Family    @relation(fields: [familyId], references: [id], onDelete: Cascade)
  projects  Project[]
  createdAt DateTime  @default(now())
}

model Project {
  id          String        @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  description String?
  coverImage  String?
  status      ProjectStatus @default(DRAFT)
  dueDate     DateTime?
  category    String?       // "Science", "History", etc.
  grade       String?       // "Grade 4", "Grade 5", etc.
  ownerId     String        @db.ObjectId
  owner       User          @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  familyId    String        @db.ObjectId
  family      Family        @relation(fields: [familyId], references: [id], onDelete: Cascade)
  researches  Research[]
  notes       Note[]
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
}
enum ProjectStatus {
  DRAFT
  IN_PROGRESS
  COMPLETED
}
model Research {
  id        String    @id @default(auto()) @map("_id") @db.ObjectId
  title     String
  projectId String    @db.ObjectId
  project   Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
  webLinks  WebLink[]
  ytLinks   YtLink[]
  imgLinks  ImgLink[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

model WebLink {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  url        String
  summary    String?
  type       LinkType @default(WEB)
  researchId String   @db.ObjectId
  research   Research @relation(fields: [researchId], references: [id], onDelete: Cascade)
  createdAt  DateTime @default(now())
}

model YtLink {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  url        String
  summary    String?
  type       LinkType @default(VIDEO)
  researchId String   @db.ObjectId
  research   Research @relation(fields: [researchId], references: [id], onDelete: Cascade)
  createdAt  DateTime @default(now())
}

model ImgLink {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  url        String
  summary    String?
  type       LinkType @default(IMAGE)
  researchId String   @db.ObjectId
  research   Research @relation(fields: [researchId], references: [id], onDelete: Cascade)
  createdAt  DateTime @default(now())
}

model Note {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  content   String
  projectId String   @db.ObjectId
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}